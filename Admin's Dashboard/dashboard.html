<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <title>Admin Dashboard - Schools24</title>
  <link rel="icon" type="image/x-icon" href="../assets/Logo.png">
  <link rel="stylesheet" href="style.css" />
  <script src="theme.js"></script>
  <style>
    /* Admin-specific styles */
    body {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      transition: all 0.3s ease;
    }

    .light-theme body {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 25%, #e9ecef 50%, #dee2e6 75%, #ced4da 100%) !important;
      background-size: 400% 400% !important;
    }

    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: #00d4ff;
      margin-bottom: 10px;
    }

    .stat-label {
      font-size: 1.1rem;
      color: #ffffff;
      opacity: 0.9;
    }

    .admin-section {
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
    }

    .section-title {
      color: #ffffff;
      font-size: 1.5rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .teacher-allocation {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 20px;
    }

    .allocation-form {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      color: #ffffff;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .form-group select,
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 5px;
      background: rgba(255,255,255,0.1);
      color: #ffffff;
      font-size: 14px;
    }

    .form-group select option {
      background: #1a1a2e;
      color: #ffffff;
    }

    .btn {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: #ffffff;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,212,255,0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff4757 0%, #c44569 100%);
    }

    .btn-danger:hover {
      box-shadow: 0 5px 15px rgba(255,71,87,0.3);
    }

    .allocation-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .allocation-item {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: between;
      align-items: center;
    }

    .allocation-info {
      flex-grow: 1;
    }

    .allocation-info h4 {
      color: #00d4ff;
      margin: 0 0 5px 0;
    }

    .allocation-info p {
      color: #ffffff;
      margin: 0;
      opacity: 0.8;
      font-size: 14px;
    }

    .allocation-actions {
      display: flex;
      gap: 10px;
    }

    .light-theme .stat-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .light-theme .stat-number {
      color: #0066cc;
    }

    .light-theme .stat-label {
      color: #333333;
    }

    .light-theme .admin-section {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .light-theme .section-title {
      color: #333333;
    }

    .light-theme .allocation-form {
      background: rgba(0,0,0,0.02);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .light-theme .form-group label {
      color: #333333;
    }

    .light-theme .form-group select,
    .light-theme .form-group input {
      background: #ffffff;
      color: #333333;
      border: 1px solid #ddd;
    }

    .light-theme .allocation-item {
      background: rgba(0,0,0,0.02);
      border: 1px solid rgba(0,0,0,0.1);
    }

    .light-theme .allocation-info h4 {
      color: #0066cc;
    }

    .light-theme .allocation-info p {
      color: #333333;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .teacher-allocation {
        grid-template-columns: 1fr;
      }
      
      .admin-stats {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }
  </style>
</head>
<body>

<header>
  <div class="headlogo">
    <a href="dashboard.html" class="lightning"></a>
    <span class="divider">|</span>
    <span class="school-text">School</span>
  </div>
  
  <!-- Hamburger Menu -->
  <button class="hamburger" id="hamburger" onclick="toggleMobileNav()">
    <span></span>
    <span></span>
    <span></span>
  </button>
  
  <div class="datetime" id="datetime"></div>
  <div class="header-right">
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
      <span class="theme-icon">üåô</span>
    </button>
    <a href="profile.html" class="StudentName" id="StudentName">
      <span>Admin</span>
      <img src="../assets/icons/profile.png" alt="Admin Profile" loading="lazy">
    </a>
  </div>
</header>

<!-- Mobile Navigation -->
<div class="mobile-nav" id="mobileNav">
  <a href="dashboard.html" class="mobile-nav-item">Dashboard</a>
  <a href="teachers.html" class="mobile-nav-item">Manage Teachers</a>
  <a href="classes.html" class="mobile-nav-item">Manage Classes</a>
  <a href="students.html" class="mobile-nav-item">Manage Students</a>
  <a href="subjects.html" class="mobile-nav-item">Manage Subjects</a>
  <a href="profile.html" class="mobile-nav-item">Profile</a>
  <div class="mobile-nav-theme">
    <button class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-icon">üåô</span>
      <span class="theme-text">Dark Mode</span>
    </button>
  </div>
</div>

<div class="main-container">
  <!-- Admin Statistics -->
  <div class="admin-stats">
    <div class="stat-card">
      <div class="stat-number" id="totalStudents">0</div>
      <div class="stat-label">Total Students</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="totalTeachers">0</div>
      <div class="stat-label">Total Teachers</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="totalClasses">0</div>
      <div class="stat-label">Total Classes</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="totalSubjects">0</div>
      <div class="stat-label">Total Subjects</div>
    </div>
  </div>

  <!-- Teacher-Class Allocation Section -->
  <div class="admin-section">
    <h2 class="section-title">
      üë®‚Äçüè´ Teacher-Class Allocation Management
    </h2>
    
    <div class="teacher-allocation">
      <!-- Allocation Form -->
      <div class="allocation-form">
        <h3 style="color: #ffffff; margin-bottom: 20px;">Assign Teacher to Class</h3>
        
        <div class="form-group">
          <label for="teacherSelect">Select Teacher:</label>
          <select id="teacherSelect">
            <option value="">Choose a teacher...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="classSelect">Select Class:</label>
          <select id="classSelect">
            <option value="">Choose a class...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="subjectSelect">Select Subject:</label>
          <select id="subjectSelect">
            <option value="">Choose a subject...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="isClassTeacher" style="width: auto; margin-right: 10px;">
            Make Class Teacher
          </label>
        </div>
        
        <button class="btn" onclick="assignTeacher()">Assign Teacher</button>
      </div>

      <!-- Current Allocations -->
      <div class="allocation-form">
        <h3 style="color: #ffffff; margin-bottom: 20px;">Current Allocations</h3>
        <div class="allocation-list" id="allocationList">
          <!-- Allocations will be loaded here -->
        </div>
        <button class="btn" onclick="refreshAllocations()">Refresh List</button>
      </div>
    </div>
  </div>

  <!-- Quick Actions Section -->
  <div class="admin-section">
    <h2 class="section-title">
      ‚ö° Quick Actions
    </h2>
    
    <div class="module-grid">
      <a href="teachers.html" class="module-card">
        <img src="../assets/icons/badge-teacher.png" alt="Teachers" loading="lazy">
        <h3>Manage Teachers</h3>
      </a>
      <a href="classes.html" class="module-card">
        <img src="../assets/icons/books icon.png" alt="Classes" loading="lazy">
        <h3>Manage Classes</h3>
      </a>
      <a href="students.html" class="module-card">
        <img src="../assets/icons/profile.png" alt="Students" loading="lazy">
        <h3>Manage Students</h3>
      </a>
      <a href="subjects.html" class="module-card">
        <img src="../assets/icons/learn teach icon.png" alt="Subjects" loading="lazy">
        <h3>Manage Subjects</h3>
      </a>
      <a href="reports.html" class="module-card">
        <img src="../assets/icons/exam icon.png" alt="Reports" loading="lazy">
        <h3>Reports</h3>
      </a>
      <a href="settings.html" class="module-card">
        <img src="../assets/icons/time table.png" alt="Settings" loading="lazy">
        <h3>System Settings</h3>
      </a>
    </div>
  </div>
</div>

<script>
// Theme toggle functionality
function toggleTheme() {
  const body = document.body;
  const themeIcon = document.querySelector('.theme-icon');
  
  if (body.classList.contains('light-theme')) {
    body.classList.remove('light-theme');
    themeIcon.textContent = 'üåô';
    localStorage.setItem('theme', 'dark');
  } else {
    body.classList.add('light-theme');
    themeIcon.textContent = '‚òÄÔ∏è';
    localStorage.setItem('theme', 'light');
  }
}

// Load saved theme
function loadTheme() {
  const savedTheme = localStorage.getItem('theme');
  const themeIcon = document.querySelector('.theme-icon');
  
  if (savedTheme === 'light') {
    document.body.classList.add('light-theme');
    themeIcon.textContent = '‚òÄÔ∏è';
  } else {
    themeIcon.textContent = 'üåô';
  }
}

// Date and time functions
function formatDate(date) {
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}/${month}/${year}`;
}

function formatTime(date) {
  return date.toLocaleTimeString(undefined, {
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });
}

function updateDateTime() {
  const now = new Date();
  const datetimeElement = document.getElementById('datetime');
  if (datetimeElement) {
    datetimeElement.textContent = `${formatDate(now)} | ${formatTime(now)}`;
  }
}

// Mobile navigation toggle
function toggleMobileNav() {
  const mobileNav = document.getElementById('mobileNav');
  const hamburger = document.getElementById('hamburger');
  
  mobileNav.classList.toggle('active');
  hamburger.classList.toggle('active');
}

// API Configuration
const API_BASE = 'http://localhost:5000/api';
let authToken = localStorage.getItem('authToken');

// API Helper function
async function apiCall(endpoint, options = {}) {
  const url = `${API_BASE}${endpoint}`;
  const config = {
    headers: {
      'Content-Type': 'application/json',
      ...(authToken && { 'Authorization': `Bearer ${authToken}` })
    },
    ...options
  };

  try {
    const response = await fetch(url, config);
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || 'API request failed');
    }
    
    return data;
  } catch (error) {
    console.error('API Error:', error);
    showNotification(error.message, 'error');
    throw error;
  }
}

// Load dashboard data
async function loadDashboardData() {
  try {
    const data = await apiCall('/admin/dashboard');
    
    // Update statistics
    document.getElementById('totalStudents').textContent = data.stats.totalStudents;
    document.getElementById('totalTeachers').textContent = data.stats.totalTeachers;
    document.getElementById('totalClasses').textContent = data.stats.totalClasses;
    document.getElementById('totalSubjects').textContent = data.stats.totalSubjects;
    
  } catch (error) {
    console.error('Failed to load dashboard data:', error);
  }
}

// Load teachers for dropdown
async function loadTeachers() {
  try {
    const data = await apiCall('/admin/teachers');
    const select = document.getElementById('teacherSelect');
    
    select.innerHTML = '<option value="">Choose a teacher...</option>';
    data.teachers.forEach(teacher => {
      const option = document.createElement('option');
      option.value = teacher._id;
      option.textContent = `${teacher.name} (${teacher.userId})`;
      select.appendChild(option);
    });
  } catch (error) {
    console.error('Failed to load teachers:', error);
  }
}

// Load classes for dropdown
async function loadClasses() {
  try {
    const data = await apiCall('/admin/classes');
    const select = document.getElementById('classSelect');
    
    select.innerHTML = '<option value="">Choose a class...</option>';
    data.classes.forEach(cls => {
      const option = document.createElement('option');
      option.value = cls._id;
      option.textContent = `${cls.name} - ${cls.grade} ${cls.section}`;
      select.appendChild(option);
    });
  } catch (error) {
    console.error('Failed to load classes:', error);
  }
}

// Load subjects for dropdown
async function loadSubjects() {
  try {
    const data = await apiCall('/admin/subjects');
    const select = document.getElementById('subjectSelect');
    
    select.innerHTML = '<option value="">Choose a subject...</option>';
    data.subjects.forEach(subject => {
      const option = document.createElement('option');
      option.value = subject._id;
      option.textContent = `${subject.name} (${subject.code})`;
      select.appendChild(option);
    });
  } catch (error) {
    console.error('Failed to load subjects:', error);
  }
}

// Assign teacher to class
async function assignTeacher() {
  const teacherId = document.getElementById('teacherSelect').value;
  const classId = document.getElementById('classSelect').value;
  const subjectId = document.getElementById('subjectSelect').value;
  const isClassTeacher = document.getElementById('isClassTeacher').checked;

  if (!teacherId || !classId || !subjectId) {
    showNotification('Please select teacher, class, and subject', 'error');
    return;
  }

  try {
    await apiCall(`/admin/classes/${classId}/assign-teacher`, {
      method: 'PUT',
      body: JSON.stringify({
        teacherId,
        subjectId,
        isClassTeacher
      })
    });

    showNotification('Teacher assigned successfully!', 'success');
    
    // Reset form
    document.getElementById('teacherSelect').value = '';
    document.getElementById('classSelect').value = '';
    document.getElementById('subjectSelect').value = '';
    document.getElementById('isClassTeacher').checked = false;
    
    // Refresh allocations
    refreshAllocations();
  } catch (error) {
    console.error('Failed to assign teacher:', error);
  }
}

// Load and display current allocations
async function refreshAllocations() {
  try {
    const data = await apiCall('/admin/classes');
    const allocationList = document.getElementById('allocationList');
    
    allocationList.innerHTML = '';
    
    data.classes.forEach(cls => {
      if (cls.subjects.length > 0) {
        cls.subjects.forEach(subject => {
          const item = document.createElement('div');
          item.className = 'allocation-item';
          
          item.innerHTML = `
            <div class="allocation-info">
              <h4>${cls.name} - ${cls.grade} ${cls.section}</h4>
              <p>${subject.subject.name} ‚Üí ${subject.teacher.name}</p>
            </div>
            <div class="allocation-actions">
              <button class="btn btn-danger" onclick="removeTeacher('${cls._id}', '${subject.teacher._id}', '${subject.subject._id}')">
                Remove
              </button>
            </div>
          `;
          
          allocationList.appendChild(item);
        });
      }
    });
    
    if (allocationList.children.length === 0) {
      allocationList.innerHTML = '<p style="color: #ffffff; text-align: center; padding: 20px;">No allocations found</p>';
    }
  } catch (error) {
    console.error('Failed to load allocations:', error);
  }
}

// Remove teacher assignment
async function removeTeacher(classId, teacherId, subjectId) {
  if (!confirm('Are you sure you want to remove this teacher assignment?')) {
    return;
  }

  try {
    await apiCall(`/admin/classes/${classId}/remove-teacher`, {
      method: 'DELETE',
      body: JSON.stringify({
        teacherId,
        subjectId
      })
    });

    showNotification('Teacher assignment removed successfully!', 'success');
    refreshAllocations();
  } catch (error) {
    console.error('Failed to remove teacher:', error);
  }
}

// Show notification
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 1000;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.3s ease;
    ${type === 'success' ? 'background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);' : ''}
    ${type === 'error' ? 'background: linear-gradient(135deg, #ff4757 0%, #c44569 100%);' : ''}
    ${type === 'info' ? 'background: linear-gradient(135deg, #5f27cd 0%, #341f97 100%);' : ''}
  `;
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.style.opacity = '1';
    notification.style.transform = 'translateY(0)';
  }, 100);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateY(-20px)';
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', function() {
  loadTheme();
  updateDateTime();
  setInterval(updateDateTime, 1000);
  
  // Load initial data
  loadDashboardData();
  loadTeachers();
  loadClasses();
  loadSubjects();
  refreshAllocations();
});
</script>

</body>
</html>

