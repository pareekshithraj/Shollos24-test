<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <title>Reports - Schools24</title>
  <link rel="icon" type="image/x-icon" href="../assets/Logo.png">
  <link rel="stylesheet" href="style.css" />
  <script src="theme.js"></script>
  <style>
    .kpi-grid { display:grid; grid-template-columns: repeat(4,1fr); gap:20px; }
    .kpi-card { background: rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:16px; padding:20px; text-align:center; }
    .kpi-value { font-size:2rem; color:#00d4ff; font-weight:700; }
    .kpi-label { opacity:.9; }
    @media(max-width: 900px){ .kpi-grid{ grid-template-columns: repeat(2,1fr);} }
    @media(max-width: 520px){ .kpi-grid{ grid-template-columns: 1fr;} }
  </style>
</head>
<body>

<header>
  <div class="headlogo">
    <a href="dashboard.html" class="lightning"></a>
    <span class="divider">|</span>
    <span class="school-text">School</span>
  </div>
  <button class="hamburger" id="hamburger" onclick="toggleMobileNav()">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <div class="datetime" id="datetime"></div>
  <div class="header-right">
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
      <span class="theme-icon">ðŸŒ™</span>
    </button>
    <a href="profile.html" class="StudentName" id="StudentName">
      <span>Admin</span>
      <img src="../assets/icons/profile.png" alt="Admin Profile" loading="lazy">
    </a>
  </div>
</header>

<div class="mobile-nav" id="mobileNav">
  <a href="dashboard.html" class="mobile-nav-item">Dashboard</a>
  <a href="teachers.html" class="mobile-nav-item">Manage Teachers</a>
  <a href="classes.html" class="mobile-nav-item">Manage Classes</a>
  <a href="students.html" class="mobile-nav-item">Manage Students</a>
  <a href="subjects.html" class="mobile-nav-item">Manage Subjects</a>
  <a href="profile.html" class="mobile-nav-item">Profile</a>
  <div class="mobile-nav-theme">
    <button class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-icon">ðŸŒ™</span>
      <span class="theme-text">Dark Mode</span>
    </button>
  </div>
</div>

<div class="main-container">
  <div class="admin-section">
    <h2 class="section-title">ðŸ“ˆ Reports</h2>
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-value" id="kpiStudents">0</div>
        <div class="kpi-label">Active Students</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value" id="kpiTeachers">0</div>
        <div class="kpi-label">Active Teachers</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value" id="kpiClasses">0</div>
        <div class="kpi-label">Active Classes</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value" id="kpiSubjects">0</div>
        <div class="kpi-label">Active Subjects</div>
      </div>
    </div>
  </div>

  <div class="admin-section">
    <h2 class="section-title">ðŸ•’ Recent Users</h2>
    <div class="allocation-list" id="recentUsers"></div>
  </div>
</div>

<script>
const API_BASE = 'http://localhost:5000/api';
let authToken = localStorage.getItem('authToken');

function formatDate(date){const d=new Date(date);return d.toLocaleDateString();}
function formatTime(date){const d=new Date(date);return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});}
function updateDateTime(){const now=new Date();const el=document.getElementById('datetime'); if(el) el.textContent=`${formatDate(now)} | ${formatTime(now)}`;}

async function apiCall(endpoint, options={}){
  const res = await fetch(`${API_BASE}${endpoint}`, {
    headers: { 'Content-Type': 'application/json', ...(authToken && { 'Authorization': `Bearer ${authToken}` }) },
    ...options
  });
  const data = await res.json();
  if(!res.ok) throw new Error(data.message || 'Request failed');
  return data;
}

function showNotification(message, type='info'){
  const n=document.createElement('div');
  n.style.cssText=`position:fixed;top:20px;right:20px;padding:12px 16px;border-radius:8px;color:#fff;z-index:1000;opacity:0;transform:translateY(-10px);transition:all .3s ease;${type==='success'?'background:#00a8ff;':type==='error'?'background:#e84118;':'background:#341f97;'}`;
  n.textContent=message;document.body.appendChild(n);requestAnimationFrame(()=>{n.style.opacity='1';n.style.transform='translateY(0)';});setTimeout(()=>{n.style.opacity='0';n.style.transform='translateY(-10px)';setTimeout(()=>n.remove(),300);},2500);
}

async function loadKPIs(){
  try{
    const data = await apiCall('/admin/dashboard');
    document.getElementById('kpiStudents').textContent = data.stats.totalStudents;
    document.getElementById('kpiTeachers').textContent = data.stats.totalTeachers;
    document.getElementById('kpiClasses').textContent = data.stats.totalClasses;
    document.getElementById('kpiSubjects').textContent = data.stats.totalSubjects;
    const recent = document.getElementById('recentUsers');
    recent.innerHTML = '';
    data.recentUsers.forEach(u=>{
      const item=document.createElement('div');
      item.className='allocation-item';
      item.innerHTML = `<div class="allocation-info"><h4>${u.name} (${u.role})</h4><p>${u.email || ''} â€¢ ${new Date(u.createdAt).toLocaleString()}</p></div>`;
      recent.appendChild(item);
    });
    if(!recent.children.length) recent.innerHTML = '<p style="color:#fff;opacity:.8;text-align:center;padding:20px;">No recent users</p>';
  }catch(e){showNotification(e.message,'error');}
}

document.addEventListener('DOMContentLoaded', ()=>{
  loadTheme();
  updateDateTime();
  setInterval(updateDateTime,1000);
  loadKPIs();
});
</script>

</body>
</html>


